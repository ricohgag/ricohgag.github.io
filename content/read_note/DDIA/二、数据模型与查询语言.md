+++
title = 'DDIA-Part2: 数据模型与查询语言'
date = 2020-10-20T11:14:33+08:00
draft = true
+++

### 概述

数据模型是开发软件最重要的部分，对软件编写方式和对思考待解决的问题都具有深远的影响。复杂的应用程序会有很多中间层，一层一层的基于下层的API构建上层API，每层抽象的提供简洁的**数据模型**来的隐藏下层的复杂性。本章将介绍一系列用于存储和查询的通用数据模型，将特别比较**关系模型、文档模型**和基于**图**的数据模型，还会讨论比较多种查询语言和他的使用场景。

### 关系模型和文档模型

#### 关系模型

关系模型定义了所有的数据格式：关系（表）是元组（行）的集合，在关系型数据库中查询优化器自动决定执行顺序以及使用哪些索引。

关系模型强在联结操作、多对一和多对多关系更简洁的表达。使用没有意义的id映射和标识多对一的信息，当信息需要修改时只需要修改信息本身，但文档模型需要修改所有冗余数据。**消除重复**是数据库**规范化**的核心思想。



#### 文档模型

文档模型模式灵活，由于局部性带来较好的性能，更接近于应用程序所使用的数据结构。文档模型中一对多的数据结构不需要联结，联结能力也很弱。

如果集合的项不具有相同的结构，此时更适合无模式的文档模型：

- 有许多不同类型对象，将每种类型对象都保存到各自的表中不太现实。

- 数据结构由无法控制的外部系统决定，而且可能随时改变。

**查询的数据局部性**：

文档通常存储为JSON、XML或二进制的连续字符串。如果应用需要频繁访问整个文档，则存储局部性具有性能优势。如果数据被划分在多个表中，则需要进行多次索引查【‘找来检索所有数据，中间可能需要更多的磁盘IO并花费更多的时间。

局部性优势只适合同时访问文档大部分内容的场景，通常数据库会加载整个文档，访问小部分内容就很浪费。且对于文档更新时，通常会重写整个文档，这方面不利因素限制了文档数据库的适用场景。

### 数据查询语言

**声明式**查询语言抽象了具体的查询过程，将查询实现交给数据库系统的查询优化器去执行，查询优化器会决定适用哪些索引和联结，以及用何种顺序来执行查询的各个语句。

命令式API则需要告诉计算机以特定的顺序执行某些操作，效率很低且不适合并行查询。

### MapReduce模型

Mongo中使用既介于声明式和命令式查询之间的语言，使用查询逻辑使用代码片段表示，这些代码片段能被处理框架重复调用。主要是基于函数式编程中的map和reduce函数实现。

Mongo2.2中增加了**聚合管道**的声明式查询语言的支持。

### 图状数据模型

图数据库适合多对多关系，图由两种对象组成：顶点和边。

#### 属性图

顶点包括：唯一的标识符、出边的集合、入边的集合和属性的集合（键值对）

每个边包括：唯一的标识符、边开始的顶点（尾部顶点）、边结束的顶点（头部顶点）、描述两个顶点见关系类型的标签和属性的集合（键值对）。

#### 三元存储

三元存储使用其他的方式描述了图的思想，三元存储中，所有的信息以（主体、谓语、客体）存储。

- 三元组的主体相当于图中的顶点。

- 三元组的客体：

1. 当客体是原始数据类型，谓语和客体相当于主体中的属性键和值。

2. 当客体是顶点时，谓语相当于客体的边，主体是尾部顶点，客体是头部顶点。

### 小结

数据最开始被描述为**层次模型**（树状），但是不利于表示多对多关系，后来发明了**关系模型**。新的 "NoSQL" 数据存储分为了两个方向。

1. **文档模型**：数据来自于自包含文档，且一个文档与其他文档之间关联很少。

2. **图模型**：所有数据都可能会互相关联。

每个数据模型都有自己的查询语言或框架，如：SQL、MapReduce、MongoDB的聚合管道、Cypher等。



