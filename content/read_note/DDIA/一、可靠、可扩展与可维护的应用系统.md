+++
title = 'DDIA-Part1: 可靠、可扩展与可维护的应用系统'
date = 2020-10-18T11:14:33+08:00
draft = true
+++

### 概述

现在大多数应用都是**数据密集型应用**，系统的关键在于**数据量**、数据的**复杂度**及数据的**快速多变性**。

数据密集型应用也是基于标准模块构建：

- 数据库：用以存储数据。

- 高速缓存：缓存复杂或操作代价昂贵的结果，加快下一次访问。

- 索引：用户可以按关键字搜索数据并支持各种过滤。

- 流式处理：持续发送消息至另一个进程，处理采用异步方式。

- 批处理：定期处理大量的累计数据。

根据需求和设计目标的差异，去组合使用适合自己应用的组件来达到我们的核心设计目标：**可靠**、**可扩展**与**可维护**。

### 数据系统

#### 可靠性

出现意外情况（硬件、软件故障、人为失误等），系统应可以继续正常运转，虽然性能可能有所降低，但确保功能正确。

- 应用程序执行用户所期望的功能。

- 可以容忍用户出现错误或不正确的软件使用方法。

- 性能可以应对典型场景、合理负载压力和数据量。

- 系统可以放置任何未经授权的访问和滥用。

**硬件故障**：硬盘崩溃、内存故障、电网停电等。解决硬件故障一般的解决方案是为硬件添加**冗余**来减少系统故障率，如磁盘RAID，服务器配备双电源，热拔插CPU，备用电源、发电机等等。

**软件错误**：软件故障的bug经常隐藏在正常使用下，碰到特定的触发条件才会也引起错误。软件系统问题没有快速解决方法，只能认真的检查代码、进行全面的测试、允许进程崩溃后自动重启、监控并分析生产环境的表现等。

**人为失误**：系统的配置出错、服务器误操作、开发API参数的边界条件等。解决方案是：

- 以最小出错的方式设计系统。

- 想办法分离容易出错的地方、容易引发故障的接口。

- 充分的测试：从单元测试到集成测试以及手动测试或自动化测试等。

- 提供快速的恢复回滚机制。

- 设置监控子系统，监控系统的性能指标和错误率。

- 推行管理流程并培训。

#### 可扩展性

随着数据量、流量（访问量）或复杂性上升，系统应能以一种合理的方式来匹配这种增长。

**描述负载**：Web服务器的qps(每秒请求处理数)、数据库写入比例、聊天室同时在线人数、缓存命中率等等。

**描述性能**：延迟与响应时间（延迟是请求花费在处理上的时间，响应时间是包括网络传输和请求处理时间）、响应时间的百分位数。

**应对负载增加的方法**：单机的垂直扩展（升级更强的配置）、无状态服务的水平扩展（无共享体系结构）。

#### 可维护性

软件的大部分成本在于整个生命周期内持续的投入（维护与缺陷修复、监控系统的运行、故障排查、技术缺陷的完善以及责怪你就爱新功能）而非最初的开发阶段。所以从软件设计时就应该考虑这些，尽可能减少运维期间的麻烦。

**可运维性**：方便运营团队保持系统平稳运行。运营团队需要负责内容：

- 监视系统的健康状况，并在服务出现异常状态时快速恢复服务。

- 追踪问题的原因。

- 保持软件和平台至最新状态。

- 了解各系统之间如果互相影响，避免执行带有破坏性的操作。

- 预测未来的问题，并在发生之前解决（如容量规划）。

- 建立用于部署、配置管理等良好的实践规范和工具包。

- 执行复杂的维护任务，例如将应用程序进行平台迁移。

- 配置更改时，维护系统的安全稳健。

- 制定流程来规范操作行为，并保持系统的安全稳定。

- 保持相关知识的传承（对系统的理解），如发生团队人员离职或新员工加入等。

系统设计可以考虑系统良好的可操作性，使运营团队可以专注于高附加值的任务：

- 提供对系统运行时行为和内部的可观测性，方便监控。

- 支持自动化与标准工具集成。

- 避免绑定特定的机器，便于动态扩展和应用迁移。

- 提供良好的文档和易于理解的操作模式，如“我做了x，会发生Y”。

- 提供良好的默认配置，允许管理员在需要时方便地修改默认值。

- 尝试自我修复，在需要时让管理员手动控制系统状态。

- 行为可预测，减少意外发生。

**简单性**：简化系统复杂性，使新工程师能轻松理解系统。

复杂性有各种表现方式：状态空间的膨胀、模块紧耦合、复杂的互相依赖关系、不一致的命名和术语、为了性能而采取的特殊处理、为解决特定问题而引入的特定框架等。

复杂性会使得维护变得困难，最终导致预算超值和进度滞后。对于复杂的软件系统，变更而引入的潜在错误的风险会显著加大。相反降低复杂性可以大大提高软件的可维护性，因此简单性应该是构建系统的关键目标之一。

消除**意外复杂性**（非软件固有、不被用户所感知，是实现本身衍生出来的问题）最好的手段是抽象，好的设计接口抽象能够隐藏大量的实现细节，并对外提供干净、易懂的接口。好的设计抽象可用于不同的应用程序，**复用**远比多次实现更有效率。

**可演化性**：后续工程师能轻松的对系统进行改进，并根据需求变化将其适配到非典型场景。

一成不变的系统需求几乎没有，想法和目标经常在变化：适配新的外部环境、新的用例、业务优先级的变化、用户要求的新功能、新平台取代旧平台、法律或法规的改变、业务增长促使架构的演变等。

敏捷开发模式为适应变化提供了很好的参考。敏捷社区还发布了很多技术工具和模式，以帮助在频繁变化的环境种开发软件，如TDD（测试驱动开发）和重构。

### 小结

本章探讨了关于数据密集型应用的基本原则，一个应用必须完成预期的多种需求，主要包括功能性需求和一些非功能性需求（如安全性、可靠性、合规性、可扩展性、兼容性、和可维护性），主要讲了**可靠性**、**可扩展性**和**可维护性**。
